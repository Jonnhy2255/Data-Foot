name: Scrape ESPN Soccer Matches

on:
  schedule:
    - cron: '0 0 * * *'   # toutes les 6 heures
  workflow_dispatch:        # permet lancement manuel

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Cloner le d√©p√¥t
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Installer Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3Ô∏è‚É£ Installer les d√©pendances
      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests beautifulsoup4

      # 4Ô∏è‚É£ Lancer le scraper
      - name: Run scraper
        run: python p_league.py

      # 5Ô∏è‚É£ Commit et push uniquement si des fichiers ont chang√©
      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Liste compl√®te des fichiers JSON
          FILES="
            data/football/leagues/England_Premier_League.json
            data/football/leagues/Spain_Laliga.json
            data/football/leagues/bundesliga.json
            data/football/leagues/Argentina_Primera_Nacional.json
            data/football/leagues/Austria_Bundesliga.json
            data/football/leagues/Belgium_Jupiler_Pro_League.json
            data/football/leagues/Brazil_Serie_A.json
            data/football/leagues/Brazil_Serie_B.json
            data/football/leagues/Chile_Primera_Division.json
            data/football/leagues/China_Super_League.json
            data/football/leagues/Colombia_Primera_A.json
            data/football/leagues/England_National_League.json
            data/football/leagues/France_Ligue_1.json
            data/football/leagues/Greece_Super_League_1.json
            data/football/leagues/Italy_Serie_A.json
            data/football/leagues/Japan_J1_League.json
            data/football/leagues/Mexico_Liga_MX.json
            data/football/leagues/Netherlands_Eredivisie.json
            data/football/leagues/Paraguay_Division_Profesional.json
            data/football/leagues/Peru_Primera_Division.json
            data/football/leagues/Portugal_Primeira_Liga.json
            data/football/leagues/Romania_Liga_I.json
            data/football/leagues/Russia_Premier_League.json
            data/football/leagues/Saudi_Arabia_Pro_League.json
            data/football/leagues/Sweden_Allsvenskan.json
            data/football/leagues/Switzerland_Super_League.json
            data/football/leagues/Turkey_Super_Lig.json
            data/football/leagues/USA_Major_League_Soccer.json
            data/football/leagues/Venezuela_Primera_Division.json
            data/football/leagues/UEFA_Champions_League.json
            data/football/leagues/UEFA_Europa_League.json
            data/football/leagues/FIFA_Club_World_Cup.json
          "

          # Ajouter uniquement les fichiers qui existent
          for f in $FILES; do
            if [ -f "$f" ]; then
              git add "$f"
            fi
          done

          # Compter le nombre de fichiers ajout√©s
          FILES_CHANGED=$(git diff --cached --name-only | wc -l)

          if [ "$FILES_CHANGED" -eq "0" ]; then
            echo "‚úÖ Aucun changement d√©tect√© dans les JSON."
          else
            echo "üîÑ $FILES_CHANGED fichier(s) modifi√©(s), commit en cours..."
            git commit -m "üîÑ Mise √† jour automatique des matchs $(date +'%Y-%m-%d %H:%M UTC')"
            git push
            echo "‚úÖ Push termin√©."
          fi

      # 6Ô∏è‚É£ Log des fichiers pour v√©rification
      - name: List JSON files
        run: ls -lh data/football/leagues/*.json
